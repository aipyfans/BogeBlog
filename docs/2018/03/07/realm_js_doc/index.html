<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />




<script data-ad-client="ca-pub-7376123380604387" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>











  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="静水流深" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="介绍 Realm JavaScript 使您能够以安全，持久和快速的方式有效编写应用程序的模型层。它旨在与 React Native 与 Node.js一起工作。 这里有个简单的例子: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354const Re">
<meta property="og:type" content="article">
<meta property="og:title" content="Realm for JavaScript(2.2.0)">
<meta property="og:url" content="http://blog.lijunbo.com/2018/03/07/realm_js_doc/index.html">
<meta property="og:site_name" content="静水流深">
<meta property="og:description" content="介绍 Realm JavaScript 使您能够以安全，持久和快速的方式有效编写应用程序的模型层。它旨在与 React Native 与 Node.js一起工作。 这里有个简单的例子: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354const Re">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/img/docs/realm-studio.png">
<meta property="og:image" content="https://realm.io/assets/svg/products/realm-studio/apple.svg">
<meta property="og:image" content="https://realm.io/assets/svg/products/realm-studio/linux.svg">
<meta property="og:image" content="https://realm.io/assets/svg/products/realm-studio/windows.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">
<meta property="og:image" content="https://realm.io/assets/svg/docs/thumbs-down.svg">
<meta property="og:image" content="https://realm.io/assets/img/home/features/radar.jpg">
<meta property="og:updated_time" content="2019-10-08T10:39:52.111Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Realm for JavaScript(2.2.0)">
<meta name="twitter:description" content="介绍 Realm JavaScript 使您能够以安全，持久和快速的方式有效编写应用程序的模型层。它旨在与 React Native 与 Node.js一起工作。 这里有个简单的例子: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354const Re">
<meta name="twitter:image" content="https://realm.io/assets/svg/docs/thumbs-up.svg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.lijunbo.com/2018/03/07/realm_js_doc/"/>





  <title> Realm for JavaScript(2.2.0) | 静水流深 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4a874f383236eb548cfc14b4365008b8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">静水流深</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">非淡泊无以明志，非宁静无以致远</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.lijunbo.com/2018/03/07/realm_js_doc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="William-Dream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/c8b98e5df395f0e0fd3b47948b37b881.jpg?s=215">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="静水流深">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Realm for JavaScript(2.2.0)
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-07T11:11:11+08:00">
                2018-03-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/database/" itemprop="url" rel="index">
                    <span itemprop="name">database</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/07/realm_js_doc/" class="leancloud_visitors" data-flag-title="Realm for JavaScript(2.2.0)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍 "></a>介绍 <img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><p>Realm JavaScript 使您能够以安全，持久和快速的方式有效编写应用程序的模型层。它旨在与 <a href="https://facebook.github.io/react-native/" target="_blank" rel="noopener">React Native</a> 与 <a href="https://nodejs.org/" target="_blank" rel="noopener">Node.js</a>一起工作。</p>
<p>这里有个简单的例子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">const Realm = require(&apos;realm&apos;);</span><br><span class="line"></span><br><span class="line">// 定义你的模型和它们的属性</span><br><span class="line">const CarSchema = &#123;</span><br><span class="line">  name: &apos;Car&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    make:  &apos;string&apos;,</span><br><span class="line">    model: &apos;string&apos;,</span><br><span class="line">    miles: &#123;type: &apos;int&apos;, default: 0&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    name:     &apos;string&apos;,</span><br><span class="line">    birthday: &apos;date&apos;,</span><br><span class="line">    cars:     &apos;Car[]&apos;,</span><br><span class="line">    picture:  &apos;data?&apos; // 可选属性</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Realm.open(&#123;schema: [CarSchema, PersonSchema]&#125;)</span><br><span class="line">  .then(realm =&gt; &#123;</span><br><span class="line">    // 创建Realm对象并写入本地存储</span><br><span class="line">    realm.write(() =&gt; &#123;</span><br><span class="line">      const myCar = realm.create(&apos;Car&apos;, &#123;</span><br><span class="line">        make: &apos;Honda&apos;,</span><br><span class="line">        model: &apos;Civic&apos;,</span><br><span class="line">        miles: 1000,</span><br><span class="line">      &#125;);</span><br><span class="line">      myCar.miles += 20; // 更新属性值</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 通过Realm实例查询所有高于1000里程车</span><br><span class="line">    const cars = realm.objects(&apos;Car&apos;).filtered(&apos;miles &gt; 1000&apos;);</span><br><span class="line"></span><br><span class="line">    // 将返回一个结果对象(1辆车)</span><br><span class="line">    cars.length // =&gt; 1</span><br><span class="line"></span><br><span class="line">    // 添加另一辆车</span><br><span class="line">    realm.write(() =&gt; &#123;</span><br><span class="line">      const myCar = realm.create(&apos;Car&apos;, &#123;</span><br><span class="line">        make: &apos;Ford&apos;,</span><br><span class="line">        model: &apos;Focus&apos;,</span><br><span class="line">        miles: 2000,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 查看结果:已经实时更新了</span><br><span class="line">    cars.length // =&gt; 2</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(error =&gt; &#123;</span><br><span class="line">    console.log(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>请注意，如果要将Realm用于服务器端或者Node环境，则在<a href="https://realm.io/docs/realm-object-server/latest/" target="_blank" rel="noopener">Realm对象服务器文档</a>中可找到相关信息。</p>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>按照下面的安装说明通过npm安装Realm JavaScript，或者在github上查看源代码。</p>
<p><strong>必要条件</strong></p>
<ul>
<li>确保您的环境设置为运行React Native应用程序。按照<a href="https://facebook.github.io/react-native/docs/getting-started.html" target="_blank" rel="noopener">React Native说明</a>开始使用。</li>
<li>使用Realm的应用程序可以同时针对iOS和Android。</li>
<li>支持React Native 0.31.0及更高版本。</li>
</ul>
<ul>
<li><p><strong>安装</strong></p>
<ul>
<li><p>创建一个新的React Native工程:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">react-native init &lt;project-name&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将目录更改为新项目(<code>cd &lt;project-name&gt;</code>)，并添加<code>realm</code>依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save realm</span><br></pre></td></tr></table></figure>
</li>
<li><p>接下来，将项目链接到<code>realm</code>原生模块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">react-native link realm</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><em>Android的警告</em>：根据版本， <code>react-native link</code>可能会生成无效的配置，正确更新Gradle(<code>android/settings.gradle</code> and <code>android/app/build.gradle</code>) ，但无法添加Realm模块。确认<code>react-native link</code>已添加了Realm模块;如果没有，请通过以下步骤手动链接到库：</p>
<ol>
<li><p>添加以下行到 <code>android/settings.gradle</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include &apos;:realm&apos;</span><br><span class="line">project(&apos;:realm&apos;).projectDir = new File(rootProject.projectDir, &apos;../node_modules/realm/android&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>将编译行添加到 <code>android/app/build.gradle</code> 中的依赖项:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile project(&apos;:realm&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>MainApplication.java</code>中添加导入并链接包:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import io.realm.react.RealmReactPackage; // add this import</span><br><span class="line"></span><br><span class="line">public class MainApplication extends Application implements ReactApplication &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected List&lt;ReactPackage&gt; getPackages() &#123;</span><br><span class="line">        return Arrays.&lt;ReactPackage&gt;asList(</span><br><span class="line">            new MainReactPackage(),</span><br><span class="line">            new RealmReactPackage() // 添加这行</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>现在已经准备好了。要查看Realm中的action，请在<code>index.ios.js</code>或<code>index.android.js</code>中添加以下作为<code>class &lt;project-name&gt;</code>的定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">const Realm = require(&apos;realm&apos;);</span><br><span class="line"></span><br><span class="line">class &lt;project-name&gt; extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123; realm: null &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    Realm.open(&#123;</span><br><span class="line">      schema: [&#123;name: &apos;Dog&apos;, properties: &#123;name: &apos;string&apos;&#125;&#125;]</span><br><span class="line">    &#125;).then(realm =&gt; &#123;</span><br><span class="line">      realm.write(() =&gt; &#123;</span><br><span class="line">        realm.create(&apos;Dog&apos;, &#123;name: &apos;Rex&apos;&#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">      this.setState(&#123; realm &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    const info = this.state.realm</span><br><span class="line">      ? &apos;Number of dogs in this Realm: &apos; + this.state.realm.objects(&apos;Dog&apos;).length</span><br><span class="line">      : &apos;Loading...&apos;;</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">      &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.welcome&#125;&gt;</span><br><span class="line">          &#123;info&#125;</span><br><span class="line">        &lt;/Text&gt;</span><br><span class="line">      &lt;/View&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，您可以在设备和模拟器中运行应用程序.</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>例子可以在<a href="https://github.com/realm/realm-js/tree/master/examples" target="_blank" rel="noopener">realm-js仓库</a>的github上找到。</p>
<p>请注意，在Android上，您需要安装ndk，并且必须设置android_ndk环境变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ANDROID_NDK=/usr/local/Cellar/android-ndk/r10e</span><br></pre></td></tr></table></figure>
<h3 id="Realm-Studio"><a href="#Realm-Studio" class="headerlink" title="Realm Studio"></a>Realm Studio</h3><p>Realm Studio 是我们的首选开发工具，可以轻松管理Realm数据库和Realm平台。使用Realm Studio，您可以打开和编辑本地和同步Realm，并管理任何Realm对象服务器实例。它支持Mac, Windows 和 Linux 系统。</p>
<p><img src="https://realm.io/assets/img/docs/realm-studio.png" alt="Realm Studio"></p>
<p><a href="https://studio-releases.realm.io/latest/download/mac-dmg" target="_blank" rel="noopener"><img src="https://realm.io/assets/svg/products/realm-studio/apple.svg" alt="img">下载 Mac 版</a></p>
<p><a href="https://studio-releases.realm.io/latest/download/linux-appimage" target="_blank" rel="noopener"><img src="https://realm.io/assets/svg/products/realm-studio/linux.svg" alt="img">下载 Linux 版</a></p>
<p><a href="https://studio-releases.realm.io/latest/download/win-setup" target="_blank" rel="noopener"><img src="https://realm.io/assets/svg/products/realm-studio/windows.svg" alt="img">下载 Windows 版</a></p>
<h2 id="获得帮助"><a href="#获得帮助" class="headerlink" title="获得帮助"></a>获得帮助<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><ul>
<li><strong>需要帮助你的代码？</strong> <a href="http://stackoverflow.com/questions/ask?tags=realm" target="_blank" rel="noopener">在StackOverflow上提问吧</a>. 我们积极监督并立马回答您的问题！</li>
<li><strong>有Bug上报?</strong> <a href="https://github.com/realm/realm-js/issues/new" target="_blank" rel="noopener">在我们Github库上提问吧</a>. 如果可能，请包括Realm版本，完整日志，Realm文件以及显示问题的项目。</li>
<li><strong>有功能请求吗?</strong> <a href="https://github.com/realm/realm-js/issues/new" target="_blank" rel="noopener">在我们Github库上提交请求吧吧</a>. 告诉我们功能应该做什么，以及为什么要这个功能.</li>
</ul>
<p>如果您使用崩溃记录（如Crashlytics或HockeyApp），请确保启用日志收集。Realm在抛出异常和不可恢复的情况下记录元数据信息（但不包含用户数据），并且这些消息可以帮助在出现问题时进行调试。</p>
<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><p>Realm数据模型由初始化期间传递到Realm的schema信息定义。对象的<code>schema</code>由对象的<code>名称(name)</code>和一组属性组成，每个属性由<code>名称(name)</code>和<code>类型(type)</code>以及对象和列表属性的<code>objectType</code>组成。您还可以将每个属性指定为<code>可选optional</code>的或具有<code>默认default</code>的值,以及<code>索引indexed</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">const Realm = require(&apos;realm&apos;);</span><br><span class="line"></span><br><span class="line">const CarSchema = &#123;</span><br><span class="line">  name: &apos;Car&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    make:  &apos;string&apos;,</span><br><span class="line">    model: &apos;string&apos;,</span><br><span class="line">    miles: &#123;type: &apos;int&apos;, default: 0&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    name:     &apos;string&apos;,</span><br><span class="line">    birthday: &apos;date&apos;,</span><br><span class="line">    cars:     &apos;Car[]&apos;</span><br><span class="line">    picture:  &apos;data?&apos;, // 可选的属性</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 使用Car和Person的模型初始化Realm实例</span><br><span class="line">Realm.open(&#123;schema: [CarSchema, PersonSchema]&#125;)</span><br><span class="line">  .then(realm =&gt; &#123;</span><br><span class="line">    // ... 使用Realm实力来读取和修改数据</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><blockquote>
<p>在这一点上，支持通过类定义模型是有限制的。它能在React Native中运行，但不能在Node环境中。</p>
</blockquote>
<p>如果你想使用ES2015类（也许想继承现有的功能），你只需要在构造函数中定义模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">  get fullName() &#123;</span><br><span class="line">    return this.firstName + &apos; &apos; + this.lastName;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person.schema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    firstName: &apos;string&apos;,</span><br><span class="line">    lastName: &apos;string&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>您现在可以将该类本身传递给打开的配置的<code>schema</code>属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Realm.open(&#123;schema: [Person]&#125;)</span><br><span class="line">  .then( /* ... */ );</span><br></pre></td></tr></table></figure>
<p>或者像往常一样访问属性:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  const john = realm.create(&apos;Person&apos;, &#123;</span><br><span class="line">    firstName: &apos;John&apos;,</span><br><span class="line">    lastName: &apos;Smith&apos;</span><br><span class="line">  &#125;);</span><br><span class="line">  john.lastName = &apos;Peterson&apos;;</span><br><span class="line">  console.log(john.fullName); // -&gt; &apos;John Peterson&apos;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Supported-types"><a href="#Supported-types" class="headerlink" title="Supported types"></a>Supported types</h3><p>Realm支持以下基本类型: <code>bool</code>, <code>int</code>, <code>float</code>, <code>double</code>, <code>string</code>, <code>data</code>, 和 <code>date</code>.</p>
<ul>
<li><code>bool</code> 属性映射到 JavaScript <code>Boolean</code> 对象</li>
<li><code>int</code>, <code>float</code>, and <code>double</code> 属性映射到 JavaScript <code>Number</code> 对象. 内部的<code>int</code>和<code>double</code>被存储为64位，而<code>float</code>以32位存储。</li>
<li><code>string</code> 属性映射到 <code>String</code></li>
<li><code>data</code> 属性映射到 <code>ArrayBuffer</code></li>
<li><code>date</code> 属性映射到 <code>Date</code></li>
</ul>
<p>将基本属性指定为简写时，您可以仅指定类型，而不必指定具有单个条目的字典：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const CarSchema = &#123;</span><br><span class="line">  name: &apos;Car&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    // 以下属性类型是等效的 </span><br><span class="line">    make:   &#123;type: &apos;string&apos;&#125;,</span><br><span class="line">    model: &apos;string&apos;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="可选属性"><a href="#可选属性" class="headerlink" title="可选属性"></a>可选属性</h4><p>默认情况下，基本类型是非可选的，不支持存储<code>null</code>或<code>undefined</code>。属性可以通过在属性定义中指定<code>optional</code>指示符或使用简写语法，通过附加一个<code>?</code>到类型名称后面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    realName:    &apos;string&apos;, // 要求属性</span><br><span class="line">    displayName: &apos;string?&apos;, // 可选属性</span><br><span class="line">    birthday:    &#123;type: &apos;date&apos;, optional: true&#125;, // 可选属性</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let realm = new Realm(&#123;schema: [PersonSchema, CarSchema]&#125;);</span><br><span class="line"></span><br><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  // 可选属性可以在创建时设置为null或未定义</span><br><span class="line">  let charlie = realm.create(&apos;Person&apos;, &#123;</span><br><span class="line">    realName: &apos;Charlie&apos;,</span><br><span class="line">    displayName: null, // 也可以完全省略</span><br><span class="line">    birthday: new Date(1995, 11, 25),</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // 可选属性可以设置为`null`, `undefined`,</span><br><span class="line">  // 或新的非空值</span><br><span class="line">  charlie.birthday = undefined;</span><br><span class="line">  charlie.displayName = &apos;Charles&apos;;</span><br><span class="line"></span><br><span class="line">  // 将非可选属性设置为null会抛出`TypeError`</span><br><span class="line">  // charlie.realName = null;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="列表属性"><a href="#列表属性" class="headerlink" title="列表属性"></a>列表属性</h4><p>除了存储单个值之外，还可以将属性声明为任何支持的基本类型的列表。这是通过将<code>[]</code>附加到类型名称来完成的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    name: &apos;string&apos;,</span><br><span class="line">    testScores: &apos;double?[]&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let realm = new Realm(&#123;schema: [PersonSchema, CarSchema]&#125;);</span><br><span class="line"></span><br><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  let charlie = realm.create(&apos;Person&apos;, &#123;</span><br><span class="line">    name: &apos;Charlie&apos;,</span><br><span class="line">    testScores: [100.0]</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // 查理在第二次考试中缺席了并且被允许跳过它</span><br><span class="line">  charlie.testScores.push(null);</span><br><span class="line"></span><br><span class="line">  // 然后他在第三次测试中表现不佳</span><br><span class="line">  charlie.testScores.push(70.0);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>访问列表属性时会返回一个<code>列表List</code>对象。<code>列表List</code>的方法非常类似于常规的JavaScript数组。最大的区别是对<code>列表List</code>所做的任何更改都会自动保存到底层Realm，因此只能在<a href="https://realm.io/docs/javascript/latest/#writes" target="_blank" rel="noopener">写入事务</a>中进行修改。此外，<code>列表List</code>属于它们从中获取的底层对象 - 您只能通过访问拥有对象中的属性来获取列表实例，并且不能手动创建它们。</p>
<p>虽然list属性中的值可以是可选的，但list属性本身不可以。使用longhand语法 (<code>values: {type: &#39;int[]&#39;, optional: true}</code>)指定list属性为可选项，将使列表中的值成为可选项。</p>
<h3 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h3><h4 id="一对一的关系"><a href="#一对一的关系" class="headerlink" title="一对一的关系"></a>一对一的关系</h4><p>对于一对一的关系，您可以将引用的对象<code>schema</code>的<code>name</code>属性指定为属性的<code>类型(type)</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    // 所有以下属性定义是等效的</span><br><span class="line">    car: &#123;type: &apos;Car&apos;&#125;,</span><br><span class="line">    van: &apos;Car&apos;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用对象属性时，需要确保所有引用的类型都存在于用于打开<code>Realm</code>的<code>schema</code>中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// CarSchema是必需的，因为PersonSchema包含&apos;car&apos;类型的属性，</span><br><span class="line">Realm.open(&#123;schema: [CarSchema, PersonSchema]&#125;).then(/* ... */);</span><br></pre></td></tr></table></figure>
<p>访问对象属性时，可以使用普通属性语法访问嵌套属性:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  const nameString = person.car.name;</span><br><span class="line">  person.car.miles = 1100;</span><br><span class="line">  </span><br><span class="line">  // 通过将属性设置为具有所有必填字段的对象来创建Car实例</span><br><span class="line">  person.van = &#123;make: &apos;Ford&apos;, model: &apos;Transit&apos;&#125;;</span><br><span class="line"></span><br><span class="line">  // 将两个属性设置为同一个汽车实例</span><br><span class="line">  person.car = person.van;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Realm中的对象属性始终是可选的，不必像这样明确指定，并且不能使其成为必需。</p>
<h4 id="一对多的关系"><a href="#一对多的关系" class="headerlink" title="一对多的关系"></a>一对多的关系</h4><p>就像基本属性一样，你也可以有一个对象列表来形成一对多的关系。这可以通过将<code>[]</code>添加到目标对象<code>schema</code>的名称或通过将属性类型设置为<code>列表list</code>并指定<code>objectType</code>来完成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    // 以下属性定义是等效的</span><br><span class="line">    cars: &#123;type: &apos;list&apos;, objectType: &apos;Car&apos;&#125;,</span><br><span class="line">    vans: &apos;Car[]&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let carList = person.cars;</span><br><span class="line"></span><br><span class="line">// 将新车添加到列表`List`中</span><br><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  carList.push(&#123;make: &apos;Honda&apos;, model: &apos;Accord&apos;, miles: 100&#125;);</span><br><span class="line">  carList.push(&#123;make: &apos;Toyota&apos;, model: &apos;Prius&apos;, miles: 200&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let secondCar = carList[1].model;  // access using an array index</span><br></pre></td></tr></table></figure>
<p>与其他列表和一对一关系不同，一对多关系不能作为可选项。</p>
<h4 id="多对多关系"><a href="#多对多关系" class="headerlink" title="多对多关系"></a>多对多关系</h4><p>链接是单向的。所以如果一对多的属性<code>Person.dogs</code>链接到一个<code>Dog</code>实例和一个属性<code>Dog.owner</code>链接到<code>Person</code>，这些链接是彼此独立的。将<code>Dog</code>添加到<code>Person</code>实例的 <code>dogs</code> 属性不会自动将该狗的<code>owner</code> 属性设置为此<code>Person</code>。因为手动同步<code>成对</code>关系很容易出错，并且比较复杂和容易生成重复信息，所以Realm提供链接对象属性来表示这些反向关系。</p>
<p>使用链接对象属性，可以从特定属性获取链接到给定对象的所有对象。例如，<code>Dog</code>对象可以具有一个名为<code>owner</code>的属性，该属性包含其<code>dogs</code>属性中具有这个确切<code>Dog</code>对象的所有<code>Person</code>对象。通过<code>owners</code>属性的<code>linkingObjects</code>类型，指定它与Person对象的关系。</p>
<p>这样做可以通过<code>owners</code>属性指定它与Person对象的关系。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    dogs: &apos;Dog[]&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const DogSchema = &#123;</span><br><span class="line">  name:&apos;Dog&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    // ``对象属性没有简写语法</span><br><span class="line">    owners: &#123;type: &apos;linkingObjects&apos;, objectType: &apos;Person&apos;, property: &apos;dogs&apos;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一个<code>linksObjects</code>属性可以指向一个<code>List</code>属性（多对多关系）或一个<code>Object</code>属性（一对一关系）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const ShipSchema = &#123;</span><br><span class="line">  name: &apos;Ship&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    captain: &apos;Captain&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const CaptainSchema = &#123;</span><br><span class="line">  name: &apos;Captain&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    ships: &#123;type: &apos;linkingObjects&apos;, objectType: &apos;Ship&apos;, property: &apos;captain&apos;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问<code>linksObjects</code>属性时，返回一个<code>Results</code>对象，因此完全支持进一步的<a href="https://realm.io/docs/javascript/latest/#queries" target="_blank" rel="noopener">查询和排序</a>。<code>linksObject</code>属性属于它们从中获取的对象，不能直接设置或操作。当事务提交时，它们将自动更新。</p>
<p><em>访问不带schema的linkingObjects</em>：如果您打开了一个Realm文件而不指定schema，例如在Realm Functions回调中，您可以通过在<code>Object</code>实例上调用 <code>linkingObjects(objectType, property)</code> 来获取<code>linksObjects</code>属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let captain = realm.objectForPrimaryKey(&apos;Captain&apos;, 1);</span><br><span class="line">let ships = captain.linkingObjects(&apos;Ship&apos;, &apos;captain&apos;);</span><br></pre></td></tr></table></figure>
<p>链接对象属性不能作为可选项。</p>
<h3 id="默认属性值"><a href="#默认属性值" class="headerlink" title="默认属性值"></a>默认属性值</h3><p>可以通过在属性定义中设置默认指示符来指定默认属性值。要使用默认值，请在创建对象期间保留未指定的属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const CarSchema = &#123;</span><br><span class="line">  name: &apos;Car&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    make:  &#123;type: &apos;string&apos;&#125;,</span><br><span class="line">    model: &#123;type: &apos;string&apos;&#125;,</span><br><span class="line">    drive: &#123;type: &apos;string&apos;, default: &apos;fwd&apos;&#125;,</span><br><span class="line">    miles: &#123;type: &apos;int&apos;,    default: 0&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  // 由于`miles`被遗漏，它默认为“0”，而`drive`被指定，它会覆盖默认值</span><br><span class="line">  realm.create(&apos;Car&apos;, &#123;make: &apos;Honda&apos;, model: &apos;Accord&apos;, drive: &apos;awd&apos;&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="索引属性"><a href="#索引属性" class="headerlink" title="索引属性"></a>索引属性</h3><p>您可以将索引的指示符添加到属性定义，以使该属性进行索引。 目前支持 <code>int</code>, <code>string</code>,  <code>bool</code> 和<code>date</code>属性类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var BookSchema = &#123;</span><br><span class="line">  name: &apos;Book&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    name: &#123; type: &apos;string&apos;, indexed: true &#125;,</span><br><span class="line">    price: &apos;float&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>索引属性将极大地加快查询的属性进行比较，但是以较慢的插入为代价。</p>
<h3 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h3><p>您可以在对象模型中为<code>string</code>和<code>int</code>属性指定<code>primaryKey</code>属性。声明一个主键可以对对象进行高效查找和更新，并强制执行每个值的唯一性。一旦有一个主键的对象被添加到Realm，主键就不能被改变了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const BookSchema = &#123;</span><br><span class="line">  name: &apos;Book&apos;,</span><br><span class="line">  primaryKey: &apos;id&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    id:    &apos;int&apos;,    // 主键</span><br><span class="line">    title: &apos;string&apos;,</span><br><span class="line">    price: &apos;float&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>主键属性自动编入索引.</p>
<h2 id="写"><a href="#写" class="headerlink" title="写"></a>写<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><p>创建，更新和删除Realm中的对象的操作必须在<code>write()</code>事务块中进行。请注意，写入事务具有不可忽略的开销;您应该尽量减少代码中写入块的数量。</p>
<h3 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h3><p>使用<code>create</code>方法创建对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">  realm.write(() =&gt; &#123;</span><br><span class="line">    realm.create(&apos;Car&apos;, &#123;make: &apos;Honda&apos;, model: &apos;Accord&apos;, drive: &apos;awd&apos;&#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">  console.log(&quot;Error on creation&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请注意， <code>write()</code>方法中抛出的任何异常都将取消事务。所有示例中都不会显示<code>try/catch</code> 块，但这是很好的做法。</p>
<h3 id="嵌套对象"><a href="#嵌套对象" class="headerlink" title="嵌套对象"></a>嵌套对象</h3><p>如果对象具有对象属性，则可以通过为每个子属性指定JSON值来递归地创建这些属性的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  realm.create(&apos;Person&apos;, &#123;</span><br><span class="line">    name: &apos;Joe&apos;,</span><br><span class="line">    // 嵌套对象是递归创建的</span><br><span class="line">    car: &#123;make: &apos;Honda&apos;, model: &apos;Accord&apos;, drive: &apos;awd&apos;&#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="更新对象"><a href="#更新对象" class="headerlink" title="更新对象"></a>更新对象</h3><h4 id="键入的更新"><a href="#键入的更新" class="headerlink" title="键入的更新"></a>键入的更新</h4><p>您可以通过在写事务中设置其属性来更新任何对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  car.miles = 1100;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="使用主键创建和更新对象"><a href="#使用主键创建和更新对象" class="headerlink" title="使用主键创建和更新对象"></a>使用主键创建和更新对象</h4><p>如果您的模型类包含主键，则可以根据主键值智能地更新或添加对象。这是通过将<code>true</code>作为第三个参数传递给<code>create</code>方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  // 创建一个book对象</span><br><span class="line">  realm.create(&apos;Book&apos;, &#123;id: 1, title: &apos;Recipes&apos;, price: 35&#125;);</span><br><span class="line"></span><br><span class="line">  // 通过ID,用新的价格更新book对象</span><br><span class="line">  realm.create(&apos;Book&apos;, &#123;id: 1, price: 55&#125;, true);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，由于一个对象已经存在，<code>id</code>值为<code>1</code>，并且我们已经为第三个参数传递了<code>true</code>，所以<code>price</code>属性被更新，而不是尝试创建一个新的对象。由于<code>name</code>属性被省略，对象保留此属性的原始值。请注意，当使用主键属性创建或更新对象时，必须指定主键。</p>
<h3 id="删除对象"><a href="#删除对象" class="headerlink" title="删除对象"></a>删除对象</h3><p>可以通过在写事务中调用<code>delete</code>方法来删除对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  // Create a book object</span><br><span class="line">  let book = realm.create(&apos;Book&apos;, &#123;id: 1, title: &apos;Recipes&apos;, price: 35&#125;);</span><br><span class="line"></span><br><span class="line">  // Delete the book</span><br><span class="line">  realm.delete(book);</span><br><span class="line"></span><br><span class="line">  // Delete multiple books by passing in a `Results`, `List`, or JavaScript `Array`</span><br><span class="line">  let allBooks = realm.objects(&apos;Book&apos;);</span><br><span class="line">  realm.delete(allBooks); // Deletes all books</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><p>查询允许您从Realm中获取单个类型的对象，并可选择过滤和排序这些结果。所有查询（包括查询和属性访问）在Realm中都是懒加载的。仅在访问对象和属性时才读取数据。这样，您可以以高效的方式表示大量数据。</p>
<p>执行查询时，您将返回一个<code>Results</code>对象。<code>Results</code>只是您的数据视图，不可变。</p>
<p>从Realm中检索对象的最基本方法是使用Realm中的<code>objects</code>方法来获取给定类型的所有对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let dogs = realm.objects(&apos;Dog&apos;); // retrieves all Dogs from the Realm</span><br></pre></td></tr></table></figure>
<h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><p>您可以通过使用查询字符串调用过滤的方法来获取已过滤的结果。</p>
<p>例如，以下将改变我们早期的例子，以检索所有具有颜色tan的狗，以’B’开头的名字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let dogs = realm.objects(&apos;Dog&apos;);</span><br><span class="line">let tanDogs = dogs.filtered(&apos;color = &quot;tan&quot; AND name BEGINSWITH &quot;B&quot;&apos;);</span><br></pre></td></tr></table></figure>
<p>目前，查询语言只支持NSPredicate语法的一部分,让我们简要总结一下支持的功能和语法：</p>
<p>Realm支持的查询语言受到了苹果公司的 <a href="https://developer.apple.com/documentation/foundation/nspredicate" target="_blank" rel="noopener">Apple’s NSPredicate</a>启发。让我们简要总结一下支持的功能和语法：</p>
<ul>
<li>比较操作数可以是属性名称或常量。至少有一个操作数必须是属性名称。特殊常量为<code>false</code>, <code>true</code>, 和 <code>null</code>.</li>
<li>时间戳可以以“YYYY-MM-DD@HH:MM:SS:NANOSECONDS” 格式指定，其中纳秒可以省略。</li>
<li>比较运算符 <code>=</code>/<code>==</code>, <code>&lt;=</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&gt;</code>, <code>!=</code>/<code>&lt;&gt;</code>,以及 <code>BETWEEN</code> 的比较运算符支持 <code>int</code>, <code>float</code>, <code>double</code>, 和 <code>Date</code> 属性类型。 e.g. <code>age = 45</code>.</li>
<li>boolean (<code>bool</code>)属性支持比较运算符<code>=</code>/<code>==</code> and <code>!=</code>/<code>&lt;&gt;</code> </li>
<li>对于字符串和数据（<code>ArrayBuffer</code>）属性，支持 <code>=</code> (and <code>==</code>), <code>!=</code> (and <code>&lt;&gt;</code>), <code>BEGINSWITH</code>, <code>CONTAINS</code>, and <code>ENDSWITH</code> 运算符。e.g. <code>name CONTAINS &#39;Ja&#39;</code>.</li>
<li>通配符比较对于具有相似运算符的字符串是可能的， e.g. <code>name LIKE &#39;*an?&#39;</code> 匹配 “Jane”, “Dan”, “Shane”, 等等.</li>
<li>使用<code>[c]</code>的字符串不区分大小写的比较，e.g. , <code>CONTAINS[c] &#39;Ja&#39;</code>. 注意只有字符“A-Z” 和 “a-z” 会被忽略。</li>
<li>Realm支持以下复合运算符：<code>AND</code>/<code>&amp;&amp;</code>, <code>OR</code>/ <code>||</code>, 和 <code>NOT</code>/<code>!</code>, e.g. <code>name BEGINSWITH &#39;J&#39; AND age &gt;= 32</code>.</li>
<li>在列表属性上支持聚合表达式 <code>@count</code>/<code>@size</code>, <code>@min</code>, <code>@max</code>, <code>@sum</code> 和 <code>@avg</code> 。eg:<code>employees.@count &gt; 5</code>查找多于5个元素的员工列表。</li>
<li>字符串和二进制属性的聚合表达式 <code>@count</code>/<code>@size</code> ，e.g. <code>name.@size = 5</code> 查找所有名称均为5个字母的名称。</li>
<li>关键路径可以遵循列表属性关系，e.g. <code>child.age &gt;= 13</code> and <a href="mailto:`cars.@avg.milage" target="_blank" rel="noopener">`cars.@avg.milage</a> &gt; 1000`.</li>
<li><code>$</code>运算符可以用来替换参数, e.g. <code>child.age &gt;= $0</code> 请参阅下面的示例）。</li>
</ul>
<p>An non-trivial example on how to query a Realm is:</p>
<p>一个关于如何查询Realm的特殊例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">const Realm = require(&apos;realm&apos;);</span><br><span class="line"></span><br><span class="line">const CarSchema = &#123;</span><br><span class="line">  name: &apos;Car&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    make:  &apos;string&apos;,</span><br><span class="line">    model: &apos;string&apos;,</span><br><span class="line">    miles: &#123;type: &apos;int&apos;, default: 0&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    name:     &apos;string&apos;,</span><br><span class="line">    cars:     &#123;type: &apos;list&apos;, objectType: &apos;Car&apos;&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// Initialize a Realm with Car and Person models</span><br><span class="line">Realm.open(&#123;schema: [CarSchema, PersonSchema]&#125;)</span><br><span class="line">    .then(realm =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        // Add persons and their cars</span><br><span class="line">        realm.write(() =&gt; &#123;</span><br><span class="line">            let john = realm.create(&apos;Person&apos;, &#123;name: &apos;John&apos;, cars: []&#125;);</span><br><span class="line">            john.cars.push(&#123;make: &apos;Honda&apos;,  model: &apos;Accord&apos;, miles: 1500&#125;);</span><br><span class="line">            john.cars.push(&#123;make: &apos;Toyota&apos;, model: &apos;Prius&apos;,  miles: 2780&#125;);</span><br><span class="line"></span><br><span class="line">            let joan = realm.create(&apos;Person&apos;, &#123;name: &apos;Joan&apos;, cars: []&#125;);</span><br><span class="line">            joan.cars.push(&#123;make: &apos;Skoda&apos;, model: &apos;Octavia&apos;, miles: 1120&#125;);</span><br><span class="line">            joan.cars.push(&#123;make: &apos;Ford&apos;,  model: &apos;Fiesta&apos;,  miles: 95&#125;);</span><br><span class="line">            joan.cars.push(&#123;make: &apos;VW&apos;,    model: &apos;Golf&apos;,    miles: 1270&#125;);</span><br><span class="line"></span><br><span class="line">            let jill = realm.create(&apos;Person&apos;, &#123;name: &apos;Jill&apos;, cars: []&#125;);</span><br><span class="line"></span><br><span class="line">            let jack = realm.create(&apos;Person&apos;, &#123;name: &apos;Jack&apos;, cars: []&#125;);</span><br><span class="line">            jack.cars.push(&#123;make: &apos;Porche&apos;, model: &apos;911&apos;,    miles: 965&#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        // Find car owners</span><br><span class="line">        let carOwners = realm.objects(&apos;Person&apos;).filtered(&apos;cars.@size &gt; 0&apos;);</span><br><span class="line">        console.log(&apos;Car owners&apos;)</span><br><span class="line">        for (let p of carOwners) &#123;</span><br><span class="line">            console.log(`  $&#123;p.name&#125;`);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Find who has been driver longer than average</span><br><span class="line">        let average = realm.objects(&apos;Car&apos;).avg(&apos;miles&apos;);</span><br><span class="line">        let longerThanAverage = realm.objects(&apos;Person&apos;).filtered(&apos;cars.@sum.miles &gt; $0&apos;, average);</span><br><span class="line">        console.log(`Longer than average ($&#123;average&#125;)`)</span><br><span class="line">        for (let p of longerThanAverage) &#123;</span><br><span class="line">            console.log(`  $&#123;p.name&#125;: $&#123;p.cars.sum(&apos;miles&apos;)&#125;`);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        realm.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The output of the code snippet is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Car owners</span><br><span class="line">  John</span><br><span class="line">  Joan</span><br><span class="line">  Jack</span><br><span class="line">Longer than average (1288.3333333333333)</span><br><span class="line">  John: 4280</span><br><span class="line">  Joan: 2485</span><br></pre></td></tr></table></figure>
<h3 id="Sorting"><a href="#Sorting" class="headerlink" title="Sorting"></a>Sorting</h3><p><code>Results</code>允许您根据单个或多个属性指定排序标准和顺序。</p>
<p>例如，以下是上述示例中查询结果返回的汽车结果集,按照数英里进行排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let hondas = realm.objects(&apos;Car&apos;).filtered(&apos;make = &quot;Honda&quot;&apos;);</span><br><span class="line"></span><br><span class="line">// 按`miles`排序hondas结果集(默认升序)</span><br><span class="line">let sortedHondas = hondas.sorted(&apos;miles&apos;);</span><br><span class="line"></span><br><span class="line">// 按`miles`的降序hondas结果集</span><br><span class="line">sortedHondas = hondas.sorted(&apos;miles&apos;, true);</span><br><span class="line"></span><br><span class="line">// 按`price`降序排序，然后按`miles`升序排序</span><br><span class="line">sortedHondas = hondas.sorted([[&apos;price&apos;, true], [&apos;miles&apos;, false]]);</span><br></pre></td></tr></table></figure>
<p><code>Results</code>也可以按照您正在排序的对象链接到的对象的值进行排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let people = realm.objects(&apos;Person&apos;);</span><br><span class="line"></span><br><span class="line">// 按他们的汽车的里程(`miles`)排序</span><br><span class="line">let sortedPeople = people.sorted(&apos;car.miles&apos;);</span><br></pre></td></tr></table></figure>
<p>基本类型<code>List</code>可以通过调用<code>sorted()</code>而不指定属性来按其值排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let person = realm.objects(&apos;Person&apos;)[0];</span><br><span class="line">let sortedTestScores = person.testScores.sorted();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>请注意，<code>Results</code>的顺序只有在查询排序后才能保证一致。出于性能原因，不保证插入顺序。</p>
</blockquote>
<h3 id="自动更新结果集"><a href="#自动更新结果集" class="headerlink" title="自动更新结果集"></a>自动更新结果集</h3><p><code>Results</code>实例是实时的，自动更新视图到底层数据中，这意味着结果集永远不需要重新获取。修改影响查询的对象将立即反映在结果集中。这是一个例外，当使用 <code>for...in</code> 或 <code>for...of</code>,时，即使其中一些被删除或修改为被排除，它将始终遍历迭代开始时与查询匹配的对象迭代期间的过滤器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let hondas = realm.objects(&apos;Car&apos;).filtered(&apos;make = &quot;Honda&quot;&apos;);</span><br><span class="line">// hondas.length == 0</span><br><span class="line"></span><br><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  realm.create(&apos;Car&apos;, &#123;make: &apos;Honda&apos;, model: &apos;RSX&apos;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">// hondas.length == 1</span><br></pre></td></tr></table></figure>
<p>这适用于所有<code>Results</code>实例，包括由<code>objects</code>,<code>filtered</code>,<code>sorted</code>方法返回的结果集。</p>
<p><code>Results</code>的这个属性不仅使Realm快速和高效，它允许您的代码更简单，更有灵活性。例如，如果您的视图依赖于查询的结果，则可以将结果存储在属性中并访问它，而无需在每次访问之前刷新其数据。</p>
<p>您可以订阅<a href="#notifications">通知</a>，以了解何时更新Realm数据，指出何时应该刷新应用的UI，而无需重新获取Results。</p>
<h3 id="限制结果集"><a href="#限制结果集" class="headerlink" title="限制结果集"></a>限制结果集</h3><p>大多数其他数据库技术提供了对查询结果进行“分页”的能力（例如SQLite中的“LIMIT”关键字）。这通常是为了避免从磁盘读取太多或者一次将太多结果拖到内存中而完成的。</p>
<p>由于Realm中的查询是懒惰的，所以执行这种分页行为根本不是必需的，因为只有在明确访问该域后，域才会从查询结果中加载对象。</p>
<p>如果由于与UI相关或其他实现原因，您需要查询中的特定对象子集，那么只需要使用<code>Results</code>对象，并只读出所需的对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let cars = realm.objects(&apos;Car&apos;);</span><br><span class="line"></span><br><span class="line">// get first 5 Car objects</span><br><span class="line">let firstCars = cars.slice(0, 5);</span><br></pre></td></tr></table></figure>
<h2 id="Realms"><a href="#Realms" class="headerlink" title="Realms"></a>Realms<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><h3 id="打开Realm实例"><a href="#打开Realm实例" class="headerlink" title="打开Realm实例"></a>打开Realm实例</h3><p>打开Realm只是通过实例化一个新的Realm对象来执行。将<code>配置对象</code>传递给构造函数。我们已经看到这个已经在示例中使用了包含<code>schema</code>键的配置对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 获得支持我们对象的默认的Realm实例</span><br><span class="line">Realm.open(&#123;schema: [Car, Person]&#125;)</span><br><span class="line">  .then(realm =&gt; &#123;</span><br><span class="line">    // ...在这里使用Realm实例</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(error =&gt; &#123;</span><br><span class="line">    // 如果发生任何错误,将在这里进行捕获处理</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>有关配置对象的完整详细信息，请参阅API参考以进行<a href="https://realm.io/docs/javascript/latest/api/Realm.html#~Configuration" target="_blank" rel="noopener">配置</a>。对象的一些更常见的键，除了<code>schema</code>，包括：</p>
<ul>
<li><code>path</code>: 指定<a href="https://realm.io/docs/javascript/latest/#other-realms" target="_blank" rel="noopener">另一个Realm</a>的路径</li>
<li><code>migration</code>: <a href="https://realm.io/docs/javascript/latest/#migrations" target="_blank" rel="noopener">迁移功能</a></li>
<li><code>sync</code>: <a href="https://realm.io/docs/javascript/latest/#sync" target="_blank" rel="noopener">同步对象</a>, ，打开与Realm对象服务器同步的Realm</li>
<li><code>inMemory</code>:Realm将在内存中打开，并且对象不会持久化;一旦最后一个Realm实例关闭，所有对象都会销毁.</li>
<li><code>deleteRealmIfMigrationNeeded</code>:如果需要迁移，则删除领域;这在开发中很有用，因为数据模型可能经常变化</li>
</ul>
<h3 id="默认Realm实例"><a href="#默认Realm实例" class="headerlink" title="默认Realm实例"></a>默认Realm实例</h3><p>在以前的所有例子中可能已经注意到路径参数已被省略。在这种情况下，使用默认的Realm路径。您可以使用<code>Realm.defaultPath</code>全局属性访问和更改默认的Realm路径。</p>
<h3 id="其他Realm实例"><a href="#其他Realm实例" class="headerlink" title="其他Realm实例"></a>其他Realm实例</h3><p>有多个Realm在多个位置持久化是有用的。例如，除了您的主Realm外，您还可能希望将一些数据与您的应用程序捆绑在Realm文件中。您可以通过在初始化Realm时指定<code>路径path</code>参数来执行此操作。所有路径都相对于您的应用程序的可写入文档目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Open a realm at another path</span><br><span class="line">Realm.open(&#123;</span><br><span class="line">  path: &apos;anotherRealm.realm&apos;,</span><br><span class="line">  schema: [CarSchema]</span><br><span class="line">&#125;).then(/* ... */);</span><br></pre></td></tr></table></figure>
<h3 id="Schema版本"><a href="#Schema版本" class="headerlink" title="Schema版本"></a>Schema版本</h3><p>打开Realm时可用的另一个选项是<code>schemaVersion</code>属性。当省略时，<code>schemaVersion</code>属性默认为0.在使用包含与之前规范不同的对象的Schema初始化现有Realm时，需要指定<code>schemaVersion</code>。如果Schema被更新并且<code>schemaVersion</code>不是之前的结构，将抛出异常。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    name: &apos;string&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// schemaVersion defaults to 0</span><br><span class="line">Realm.open(&#123;schema: [PersonSchema]&#125;);</span><br></pre></td></tr></table></figure>
<p>如果你后来做这样的操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const UpdatedPersonSchema = &#123;</span><br><span class="line">  // 因为schema名称相同, 所以以前的“Person”对象在Realm将会更新</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    name: &apos;string&apos;,</span><br><span class="line">    dog:  &apos;Dog&apos;     // 新属性</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 这将抛出异常，因为schema已经改变和`schemaVersion`还没有指定</span><br><span class="line">Realm.open(&#123;schema: [UpdatedPersonSchema]&#125;);</span><br><span class="line"></span><br><span class="line">// 这将成功并将Realm更新到新的schema</span><br><span class="line">Realm.open(&#123;schema: [UpdatedPersonSchema], schemaVersion: 1&#125;);</span><br></pre></td></tr></table></figure>
<p>如果您想要检索当前的<code>Realm</code> 的 <code>schema</code> 的版本，可以使用<code>Realm.schemaVersion</code>方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const currentVersion = Realm.schemaVersion(Realm.defaultPath);</span><br></pre></td></tr></table></figure>
<h3 id="异步打开Realm"><a href="#异步打开Realm" class="headerlink" title="异步打开Realm"></a>异步打开Realm</h3><p>您可以通过简单地调用构造函数并将<code>配置对象</code>传递给它来创建Realm实例。通常不推荐这样做，因为它会阻止并且可能是一项耗时的操作，尤其是在要<a href="#迁移">迁移</a>的情况下运行,或者Realm已<a href="#同步">同步</a>,并且您不希望在数据完全下载之前修改数据。</p>
<p>如果你仍然想这样做，模式很简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const realm = new Realm(&#123;schema: [PersonSchema]&#125;);</span><br><span class="line"></span><br><span class="line">// You can now access the realm instance.</span><br><span class="line">realm.write(/* ... */);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果Realm具有只读<a href="https://realm.io/docs/javascript/latest/#access-control" target="_blank" rel="noopener">权限</a>，那么您必须使用异步API来打开它。用上述模式打开只读领域将导致错误。</p>
</blockquote>
<h2 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><p>在使用数据库时，您的数据模型很可能随时间而改变。例如，假设我们有以下<code>Person</code>模型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    firstName: &apos;string&apos;,</span><br><span class="line">    lastName: &apos;string&apos;,</span><br><span class="line">    age: &apos;int&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们要更新数据模型，用来添加一个<code>name</code>属性，而不是单独的名字和姓氏。为此，我们只需将schema更改为以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const PersonSchema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    name: &apos;string&apos;,</span><br><span class="line">    age: &apos;int&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这一点上，如果您使用以前的<code>model</code>版本保存了任何数据，新的代码和Realm已存储在磁盘上的旧数据将不匹配。发生这种情况时，当您尝试使用新的<code>schema</code>打开现有的Realm时，将抛出异常，除非运行迁移。</p>
<h3 id="进行迁移"><a href="#进行迁移" class="headerlink" title="进行迁移"></a>进行迁移</h3><p>您可以通过更新<a href="https://realm.io/docs/javascript/latest/#schema-version" target="_blank" rel="noopener">schemaVersion</a>并定义可选的迁移函数来定义迁移和关联的schema版本。您的迁移函数提供将数据模型从以前的schema转换为新的schema所需的任何逻辑。当打开Realm时，只有在需要迁移时，才会将迁移函数应用于将Realm更新到给定的schema版本。</p>
<p>如果没有提供迁移函数，则当更新到新的<code>schemaVersion</code>时，任何新的属性将自动添加并且旧的属性从数据库中删除。如果您需要在升级版本时更新旧的或填充的新属性，那么可以在迁移函数中执行此操作。例如，假设我们要迁移先前声明的<code>Person</code>模型。您可以使用旧的<code>firstName</code>和<code>lastName</code>属性填充新模式的<code>name</code>属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Realm.open(&#123;</span><br><span class="line">  schema: [PersonSchema],</span><br><span class="line">  schemaVersion: 1,</span><br><span class="line">  migration: (oldRealm, newRealm) =&gt; &#123;</span><br><span class="line">    // only apply this change if upgrading to schemaVersion 1</span><br><span class="line">    if (oldRealm.schemaVersion &lt; 1) &#123;</span><br><span class="line">      const oldObjects = oldRealm.objects(&apos;Person&apos;);</span><br><span class="line">      const newObjects = newRealm.objects(&apos;Person&apos;);</span><br><span class="line"></span><br><span class="line">      // loop through all objects and set the name property in the new schema</span><br><span class="line">      for (let i = 0; i &lt; oldObjects.length; i++) &#123;</span><br><span class="line">        newObjects[i].name = oldObjects[i].firstName + &apos; &apos; + oldObjects[i].lastName;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(realm =&gt; &#123;</span><br><span class="line">  const fullName = realm.objects(&apos;Person&apos;)[0].name;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>迁移成功完成后，您的应用程序可以像往常一样访问Realm及其所有对象。</p>
<h3 id="线性迁移"><a href="#线性迁移" class="headerlink" title="线性迁移"></a>线性迁移</h3><p>使用上述迁移模式，您可能会在多个版本上迁移时遇到问题。如果用户跳过应用程序更新，并且在跳过的版本中属性已被更改多次，则可能会发生这种情况。在这种情况下，您可能需要编辑旧的迁移代码才能将数据从旧schema更新到最新schema。</p>
<p>可以通过顺序运行多个迁移来避免此问题，确保将数据库升级到每个先前版本，并运行关联的迁移代码。当遵循这种模式时，永远不需要修改旧的迁移代码，尽管您需要保留所有旧的schema和迁移模块以备将来使用。一个这样的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const schemas = [</span><br><span class="line">  &#123; schema: schema1, schemaVersion: 1, migration: migrationFunction1 &#125;,</span><br><span class="line">  &#123; schema: schema2, schemaVersion: 2, migration: migrationFunction2 &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">// 要更新的第一个schema是当前schema版本。</span><br><span class="line">// 因为第一个schema是在我们的数组里</span><br><span class="line">let nextSchemaIndex = Realm.schemaVersion(Realm.defaultPath);</span><br><span class="line">while (nextSchemaIndex &lt; schemas.length) &#123;</span><br><span class="line">  const migratedRealm = new Realm(schemas[nextSchemaIndex++]);</span><br><span class="line">  migratedRealm.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 用最新的schema打开Realm</span><br><span class="line">Realm.open(schemas[schemas.length-1]);</span><br></pre></td></tr></table></figure>
<h2 id="Notifications"><a href="#Notifications" class="headerlink" title="Notifications"></a>Notifications<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><p>Realm的 <code>Results</code>和 <code>List</code> 对象提供了<code>addListener</code>方法来注册通知回调。每当更新对象时，将调用更改通知回调。</p>
<p>有两种通知，“Realm通知”（提交写入事务时通知的简单回调）和“Collection通知”（更复杂的回调，它们在插入，删除和更新时接收更改元数据）。</p>
<p>此外，专业版和企业版提供事件处理通知。阅读“Realm移动平台”了解更多信息。</p>
<p>如果Realm升级到了最新版本, 在某些情况下，可以在事务开始时调用监听器 ，或者观察到的Realm实体以触发通知的方式被修改或删除。在这些情况下，监听器在当前写入事务的上下文中运行，因此尝试在通知处理程序中开始新的写入事务将引发异常。您可以使用<code>Realm.isInTransaction</code>属性来确定您的代码是否在写入事务中执行。</p>
<h3 id="Realm通知"><a href="#Realm通知" class="headerlink" title="Realm通知"></a>Realm通知</h3><p>每次提交写入事务时，Realm实例都会向其他实例发送通知。注册通知：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function updateUI() &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 注册 Realm 通知</span><br><span class="line">realm.addListener(&apos;change&apos;, updateUI);</span><br><span class="line"></span><br><span class="line">// ..之后移除Realm通知</span><br><span class="line">realm.removeListener(&apos;change&apos;, updateUI);</span><br><span class="line"></span><br><span class="line">// .或者将所有通知取消注册</span><br><span class="line">realm.removeAllListeners();</span><br></pre></td></tr></table></figure>
<h3 id="Collection-通知"><a href="#Collection-通知" class="headerlink" title="Collection 通知"></a>Collection 通知</h3><p>Collection通知包含描述在细粒度级别发生了哪些更改的信息。这包括自上次通知以来插入，删除或修改的对象的索引。Collection通知异步传递：首先使用初始结果，然后在任何修改Collection中的任何对象的写入事务之后，从集合中删除对象，或向集合中添加新对象。</p>
<p>当这些变化发生时，<code>addListener</code>通知回调函数会收到两个参数。第一个是更改的collection，第二个是具有关于由删除，插入和修改影响的集合索引的信息的<code>changes</code>对象。</p>
<p>前两项，<strong>删除</strong>和<strong>插入</strong>，每当对象开始和停止作为collection的一部分时，记录索引。当您将对象添加到realm或将其从realm中删除时，这将考虑在内。对于<code>Results</code>，当您过滤特定值并且对象已更改，以使其现在与查询匹配或不匹配时，此操作也适用。对于基于<code>List</code>的collection，这适用于从关系中添加或删除对象时。</p>
<p>当对象的属性发生更改时，您的应用程序将被通知有关修改，该属性以前是collection的一部分，并且仍然是其中的一部分。当一对多关系发生变化时，也会发生这种情况，但不考虑反向关系的变化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Dog &#123;&#125;</span><br><span class="line">Dog.schema = &#123;</span><br><span class="line">  name: &apos;Dog&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    name:  &apos;string&apos;,</span><br><span class="line">    age: &apos;int&apos;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">class Person &#123;&#125;</span><br><span class="line">Person.schema = &#123;</span><br><span class="line">  name: &apos;Person&apos;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    name:    &#123;type: &apos;string&apos;&#125;,</span><br><span class="line">    dogs:    &#123;type: &apos;list&apos;, objectType: &apos;Dog&apos;&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>让我们假设您正在观察上面的模型代码给出的狗主人列表。当以下情况下，您将收到关于匹配的<code>Person</code>对象的修改的通知：</p>
<ul>
<li>您修改<code>Person</code>的<code>name</code>属性。</li>
<li>你添加或删除<code>Dog</code>给<code>Person</code>的<code>dogs</code>属性。</li>
<li>您修改属于该<code>Person</code>的 <code>Dog</code>的 <code>age</code> 属性。</li>
</ul>
<p>这使得可以离散地控制对UI内的内容进行的动画和视觉更新，而不是在每次发生通知时任意重新加载所有内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// 注册通知</span><br><span class="line">realm.objects(&apos;Dog&apos;).filtered(&apos;age &lt; 2&apos;).addListener((puppies, changes) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  // 更新UI以响应插入的对象</span><br><span class="line">  changes.insertions.forEach((index) =&gt; &#123;</span><br><span class="line">    let insertedDog = puppies[index];</span><br><span class="line">    ...</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // 更新UI以响应修改的对象</span><br><span class="line">  changes.modifications.forEach((index) =&gt; &#123;</span><br><span class="line">    let modifiedDog = puppies[index];</span><br><span class="line">    ...</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // 更新UI以响应已删除的对象</span><br><span class="line">  changes.deletions.forEach((index) =&gt; &#123;</span><br><span class="line">    // 已删除的对象无法直接访问</span><br><span class="line">    // 支持即将访问已删除的对象...</span><br><span class="line">    ...</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 取消注册所有的通知</span><br><span class="line">realm.removeAllListeners();</span><br></pre></td></tr></table></figure>
<h2 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><p>在Node.js环境中进行同步，对于Linux系统来说是专业版功能，且必须在有许可的情况下才能执行。</p>
<p>在Linux系统中使用Node.js，需要指定访问许可获取token启动Sync功能。这样做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const token = &quot;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...&quot;;</span><br><span class="line"></span><br><span class="line">// Unlock Professional Edition APIs</span><br><span class="line">Realm.Sync.setFeatureToken(token);</span><br></pre></td></tr></table></figure>
<p>Realm平台跨网络扩展数据库可以实现跨设备数据同步。为了实现这种同步，Realm提供一组新的类型和类支持被同步的Realm；这些新的类型和类与现存的Realm移动数据库是协同关系。</p>
<h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><p>Realm对象服务器中的中心对象是与被同步的Realm相关联的Realm用户 (<code>Realm.Sync.User</code>) 。 <code>User</code> 访问共享Realm可以通过用户名/密码的方式进行验证，或者通过第三方验证数字验证。</p>
<p>创建及注册用户需要两个东西：</p>
<ul>
<li>可以连接到Realm对象服务器的URL</li>
<li>表明该用户适用于该验证机制的凭据（例如：用户名/密码，权限密码，等等）</li>
</ul>
<h4 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h4><p>创建用户id及用户登录需要用到验证。请参考我们的<a href="https://realm.io/docs/realm-object-server/#authentication" target="_blank" rel="noopener">认证文件</a>查找Realm移动平台支持的验证提供者。</p>
<p>指定用户的凭据信息可以通过以下几种方式建立:</p>
<ul>
<li>提供一个有效的用户名/密码组合</li>
<li>提供一个从Realm支持的第三方验证服务商处获得的token</li>
<li>提供一个token和一个自定义认证提供程序（参见 <a href="https://realm.io/docs/realm-object-server/#custom-authentication" target="_blank" rel="noopener">自定义身份验证</a>）</li>
</ul>
<p>用户名和密码验证完全由Realm对象服务器管理，允许你完全控制自己的应用程序用户管理。对于其他的验证方法，你的应用程序会登录外部服务器并获取验证token.</p>
<p>下面是一些不同的提供者设置凭证示例.</p>
<h5 id="用户名-密码"><a href="#用户名-密码" class="headerlink" title="用户名/密码"></a>用户名/密码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Realm.Sync.User.login(&apos;http://my.realm-auth-server.com:9080&apos;, &apos;username&apos;, &apos;p@s$w0rd&apos;).then(user =&gt; &#123;</span><br><span class="line">  // user is logged in</span><br><span class="line">  // do stuff ...</span><br><span class="line">&#125;).catch(error =&gt; &#123;</span><br><span class="line">  // an auth error has occurred</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>用户登录之前，必须先创建账户。你可以使用<code>Admin Dashboard</code>提前在服务器上创建，或者通过调用<code>注册（register）</code>方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Realm.Sync.User.register(&apos;http://my.realm-auth-server.com:9080&apos;, &apos;username&apos;, &apos;p@s$w0rd&apos;, (error, user) =&gt; &#123; /* ... */ &#125;);</span><br></pre></td></tr></table></figure>
<h5 id="Google"><a href="#Google" class="headerlink" title="Google"></a>Google</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const googleAccessToken = &apos;acc3ssT0ken...&apos;;</span><br><span class="line">Realm.Sync.User.registerWithProvider(&apos;http://my.realm-auth-server.com:9080&apos;, &apos;google&apos;, googleAccessToken, (error, user) =&gt; &#123; /* ... */ &#125;);</span><br></pre></td></tr></table></figure>
<h5 id="Facebook"><a href="#Facebook" class="headerlink" title="Facebook"></a>Facebook</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const fbAccessToken = &apos;acc3ssT0ken...&apos;;</span><br><span class="line">Realm.Sync.User.registerWithProvider(&apos;http://my.realm-auth-server.com:9080&apos;, &apos;facebook&apos;, fbAccessToken, (error, user) =&gt; &#123; /* ... */ &#125;);</span><br></pre></td></tr></table></figure>
<h5 id="Custom-Auth"><a href="#Custom-Auth" class="headerlink" title="Custom Auth"></a>Custom Auth</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// The user token provided by your authentication server</span><br><span class="line">const accessToken = &apos;acc3ssT0ken...&apos;;</span><br><span class="line"></span><br><span class="line">const user = Realm.Sync.User.registerWithProvider(</span><br><span class="line">  &apos;http://my.realm-auth-server.com:9080&apos;,</span><br><span class="line">  &apos;custom/fooauth&apos;,</span><br><span class="line">  accessToken,</span><br><span class="line">  (error, user) =&gt; &#123; /* ... */ &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><em>注</em>：JavaScript软件工具开发包目前不允许发送额外数据。如需要发送不止一个token，请将额外数据加密成JSON并通过accessToken参数传输，再在服务器端解码字符串。</p>
<h5 id="Logging-Out"><a href="#Logging-Out" class="headerlink" title="Logging Out"></a>Logging Out</h5><p>Logging out of a synced Realm is simple:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user.logout();</span><br></pre></td></tr></table></figure>
<p>When a user is logged out, the synchronization will stop. A logged out user can no longer open a synced Realm.</p>
<h4 id="Working-with-Users"><a href="#Working-with-Users" class="headerlink" title="Working with Users"></a>Working with Users</h4><p>The sync server URL may contain the tilde character (“~”) which will be transparently expanded to represent the user’s unique identifier. This scheme easily allows you to write your app to cater to its individual users. The location on disk for shared Realms is managed by the framework, but can be overridden if desired.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Realm.Sync.User.login(/* ... */, (error, user) =&gt; &#123;</span><br><span class="line">  if (!error) &#123;</span><br><span class="line">    Realm.open(&#123;</span><br><span class="line">      sync: &#123;</span><br><span class="line">        user: user,</span><br><span class="line">        url: &apos;realm://object-server-url:9080/~/my-realm&apos;,</span><br><span class="line">      &#125;,</span><br><span class="line">      schema: [/* ... */]</span><br><span class="line">    &#125;).then(realm =&gt; &#123;</span><br><span class="line">      /* ... */</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>Realm.Sync.User.current</code> can be used to obtain the currently logged in user. If no users have logged in or all have logged out, it will return <code>undefined</code>. If there are more than one logged in users, an error will be thrown.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const user = Realm.Sync.User.current;</span><br></pre></td></tr></table></figure>
<p>If there are likely to be multiple users logged in, you can get a collection of them by calling <code>Realm.Sync.User.all</code>. This will be empty if no users have logged in.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let users = Realm.Sync.User.all;</span><br><span class="line"></span><br><span class="line">for(const key in users) &#123;</span><br><span class="line">  const user = users[key];</span><br><span class="line"></span><br><span class="line">  // do something with the user object.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Opening-a-Synchronized-Realm"><a href="#Opening-a-Synchronized-Realm" class="headerlink" title="Opening a Synchronized Realm"></a>Opening a Synchronized Realm</h3><p>You open a synchroized Realm the same say as you open any other Realm. The <a href="https://realm.io/docs/javascript/latest/api/Realm.html#~Configuration" target="_blank" rel="noopener">configuration</a> can be extended with a <code>sync</code> property if you need to configure the synchronization. The optional properties of <code>sync</code> include:</p>
<ul>
<li><code>error</code> - a callback for error handling/reporting</li>
<li><code>validate_ssl</code> - indicating if SSL certificates must be validated</li>
<li><code>ssl_trust_certificate_path</code> - a path where to find trusted SSL certificates</li>
</ul>
<p>The error handling is set up by registering a callback (<code>error</code>) as part of the configuration:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const config = &#123;</span><br><span class="line">  sync: &#123; user: userA,</span><br><span class="line">          url: realmUrl,</span><br><span class="line">          error: err =&gt; console.log(err)</span><br><span class="line">        &#125;,</span><br><span class="line">  schema: [&#123; name: &apos;Dog&apos;, properties: &#123; name: &apos;string&apos; &#125; &#125;]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var realm = new Realm(config);</span><br></pre></td></tr></table></figure>
<h4 id="Partially-synchronized-Realms"><a href="#Partially-synchronized-Realms" class="headerlink" title="Partially synchronized Realms"></a>Partially synchronized Realms</h4><p>This feature is included as a tech preview. It is likely to change!</p>
<p>Instead of synchronized every object, it is possible to synchronize a subset. This partially synchronized Realm is based on a query, and your client will only receive the objects which fulfil the query. A simple example is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const config = &#123;</span><br><span class="line">  sync: &#123; user: userA,</span><br><span class="line">          url: realmUrl,</span><br><span class="line">          partial: true,  // &lt;-- this enables a partially synced Realm</span><br><span class="line">        &#125;,</span><br><span class="line">  schema: [&#123; name: &apos;Person&apos;, properties: &#123; name: &apos;string&apos;, age: &apos;int&apos; &#125; &#125;]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var realm = new Realm(config);</span><br><span class="line">var partialResults = realm.subscribeToObjects(&apos;Integer&apos;, &apos;age &gt; 5&apos;).then((results, error) =&gt; &#123;</span><br><span class="line">    return results;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// partialResults is updated with objects matching the query</span><br></pre></td></tr></table></figure>
<p>You may modify objects within the results collection, and these changes will be synced up to the Realm Object Server. Note that conflicts may be resolved differently than if the writes had been made to a fully-synchronized copy of the Realm.</p>
<h3 id="Working-with-a-Synchronized-Realm"><a href="#Working-with-a-Synchronized-Realm" class="headerlink" title="Working with a Synchronized Realm"></a>Working with a Synchronized Realm</h3><p>Once you have opened a Realm using a URL to a Realm Object Server and a <code>User</code>object, you can interact with it as you would any other Realm in JavaScript.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">realm.write(() =&gt; &#123;</span><br><span class="line">  realm.create(&apos;MyObject&apos;, jsonData);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var objects = realm.objects(&apos;MyObject&apos;);</span><br></pre></td></tr></table></figure>
<h3 id="Sync-Sessions"><a href="#Sync-Sessions" class="headerlink" title="Sync Sessions"></a>Sync Sessions</h3><p>A synced Realm’s connection to the Realm Object Server is represented by a <code>Session</code>object. Session objects can be retrieved by calling <code>realm.syncSession</code>.</p>
<p>The state of the underlying session can be retrieved using the <code>state</code> property. This can be used to check whether the session is active, not connected to the server, or in an error state.</p>
<h4 id="Progress-notifications"><a href="#Progress-notifications" class="headerlink" title="Progress notifications"></a>Progress notifications</h4><p>Session objects allow your app to monitor the status of a session’s uploads to and downloads from the Realm Object Server by registering a progress notification callback on a session object by calling [realm.syncSession.addProgressNotification(direction, mode, callback)] or one of the asynchronous methods <code>Realm.open</code> and <code>Realm.openAsync</code>. (<em>these methods support only a subset of the progress notifications modes</em>)</p>
<p>Progress notification callbacks will be invoked periodically by the synchronization subsystem. As many callbacks as needed can be registered on a session object simultaneously. Callbacks can either be configured to report upload progress or download progress.</p>
<p>Each time a callback is called, it will receive the current number of bytes already transferred, as well as the total number of transferable bytes (defined as the number of bytes already transferred plus the number of bytes pending transfer).</p>
<p>To stop receiving progress notifications a callback can be unregistered using [realm.syncSession.removeProgressNotification(callback)]. Calling the function a second time with the same callback is ignored.</p>
<p>There are two <a href="https://realm.io/docs/javascript/latest/api/reference/Realms.Sync.ProgressMode.html#fields" target="_blank" rel="noopener">progress notification modes</a> for the progress notifications:</p>
<ul>
<li><code>reportIndefinitely</code> - the registration will stay active until the callback is unregistered and will always report the most up-to-date number of transferable bytes. This type of callback could be used to control a network indicator UI that, for example, changes color or appears only when uploads or downloads are actively taking place.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let realm = new Realm(config);</span><br><span class="line">const progressCallback = (transferred, transferables) =&gt; &#123;</span><br><span class="line">    if (transferred &lt; transferables) &#123;</span><br><span class="line">        // Show progress indicator</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // Hide the progress indicator</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">realm.syncSession.addProgressNotification(&apos;upload&apos;, &apos;reportIndefinitely&apos;, progressCallback);</span><br><span class="line">// ...</span><br><span class="line">realm.syncSession.removeProgressNotification(progressCallback);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>forCurrentlyOutstandingWork</code> - the registration will capture the number of transferable bytes at the moment it is registered and always report progress relative to that value. Once the number of transferred bytes reaches or exceeds that initial value, the callback will be automatically unregistered. This type of progress notification could, for example, be used to control a progress bar that tracks the progress of an initial download of a synced Realm when a user signs in, letting them know how long it is before their local copy is up-to-date.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let realm = new Realm(config);</span><br><span class="line">const progressCallback = (transferred, transferable) =&gt; &#123;</span><br><span class="line">    const progressPercentage = transferred / transferable;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">realm.syncSession.addProgressNotification(&apos;download&apos;, &apos;forCurrentlyOutstandingWork&apos;, progressCallback);</span><br><span class="line">// ...</span><br><span class="line">realm.syncSession.removeProgressNotification(progressCallback);</span><br></pre></td></tr></table></figure>
<p>The asynchronous methods <code>Realm.open</code> and <code>Realm.openAsync</code> for opening a Realm can also be used to register a callback for sync progress notifications. In this case only ‘download’ direction and ‘forCurrentlyOutstandingWork’ mode are supported. Additional callbacks can be registered after the initial open is completed by using the newly created Realm instance</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Realm.open(config)</span><br><span class="line">      .progress((transferred, transferable) =&gt; &#123;</span><br><span class="line">          // update UI</span><br><span class="line">      &#125;)</span><br><span class="line">      .then(realm =&gt; &#123;</span><br><span class="line">          // use the Realm</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch((e) =&gt; reject(e));</span><br><span class="line"></span><br><span class="line">Realm.openAsync(config,</span><br><span class="line">          (error, realm) =&gt; &#123;</span><br><span class="line">             // use the Realm or report an error</span><br><span class="line">          &#125;,</span><br><span class="line">          (transferred, transferable) =&gt; &#123;</span><br><span class="line">            // update UI</span><br><span class="line">          &#125;, );</span><br></pre></td></tr></table></figure>
<h3 id="Access-Control"><a href="#Access-Control" class="headerlink" title="Access Control"></a>Access Control</h3><p>The Realm Mobile Platform provides flexible access control mechanisms to restrict which users are allowed to sync against which Realm files. This can be used, for example, to create collaborative apps where multiple users write to the same Realm. It can also be used to share data in a publisher/subscriber scenario where a single writing user shares data with many users with read permissions.</p>
<p>There are three permissions that control the access level of a given Realm for a User:</p>
<ul>
<li><code>mayRead</code> indicates that the user is allowed to read from the Realm.</li>
<li><code>mayWrite</code> indicates that the user is allowed to write to the Realm.</li>
<li><code>mayManage</code> indicates that the user is allowed to change the permissions for the Realm.</li>
</ul>
<p>Unless permissions are explicitly modified, only the owner (creator) of a Realm can access it. The only exception is admin users: They are always granted all permissions to all Realms on the server.</p>
<p><strong>Write-only</strong> permissions (i.e., <code>mayWrite</code> set without <code>mayRead</code>) are not currently supported.</p>
<p>Please refer to the general Realm Object Server documentation on <a href="https://realm.io/docs/realm-object-server/latest/#access-control" target="_blank" rel="noopener">Access Control</a> to learn more about the concept.</p>
<h4 id="Retrieving-Permissions"><a href="#Retrieving-Permissions" class="headerlink" title="Retrieving Permissions"></a>Retrieving Permissions</h4><p>To get a collection of all the Permissions a user has been granted, use the <code>User.getGrantedPermissions</code> method:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const permissions = user.getGrantedPermissions(&quot;currentUser&quot;);</span><br><span class="line"></span><br><span class="line">// Permissions is a regular query</span><br><span class="line">const writePermissions = permissions.filtered(&quot;mayWrite = true&quot;);</span><br><span class="line"></span><br><span class="line">// Queries are live and emit notifications</span><br><span class="line">writePermissions.addListener((collection, changes) =&gt; &#123;</span><br><span class="line">    // handle permission changes</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>To get permissions granted <strong>by</strong> a user, pass in <code>&quot;otherUser&quot;</code>.</p>
<h4 id="Modifying-Permissions"><a href="#Modifying-Permissions" class="headerlink" title="Modifying Permissions"></a>Modifying Permissions</h4><p>Modifying the access control settings for a Realm file is performed by either applying permissions directly or offering them.</p>
<h5 id="Granting-Permissions"><a href="#Granting-Permissions" class="headerlink" title="Granting Permissions"></a>Granting Permissions</h5><p>Permission changes can be applied (i.e. granted or revoked) via the <code>User.applyPermissions</code> method in order to directly increase or decrease other users’ access level to a Realm.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const condition = &#123; userId: &apos;some-user-id&apos; &#125;;</span><br><span class="line">const realmUrl = &quot;realm://my-server.com/~/myRealm&quot;;</span><br><span class="line">user.applyPermissions(condition, realmUrl, &apos;read&apos;);</span><br></pre></td></tr></table></figure>
<p>The <code>condition</code> parameter must be an object containing either</p>
<ul>
<li><code>userId</code> - use this to apply permissions based on a user’s identity (the internal Id that Realm generates).</li>
<li><code>metadataKey</code> and <code>metadataValue</code> - use the key <code>&#39;email&#39;</code> and an email address as the value to specify a user via the Username/Password provider.</li>
</ul>
<p>The last argument controls the access level that the user will be granted. Higher access implies all lower tiers, e.g. <code>write</code> implies <code>read</code>, <code>admin</code> implies <code>read</code> and <code>write</code>. If <code>none</code> is passed, this will revoke the user’s permissions for this Realm.</p>
<h5 id="Offer-Response"><a href="#Offer-Response" class="headerlink" title="Offer/Response"></a>Offer/Response</h5><p>A user can offer permissions to their Realm by sharing the opaque token returned by <code>offerPermissionsAsync</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const realmUrl = &apos;realm://my-server.com/~/myRealm&apos;;</span><br><span class="line">const oneDay = 1000 * 60 * 60 * 24;</span><br><span class="line">const expiration = new Date(Date.now() + 7 * oneDay);</span><br><span class="line">userA.offerPermissions(realmUrl, &apos;write&apos;, expiration)</span><br><span class="line">  .then(token =&gt; &#123; /* ... */ &#125;);</span><br></pre></td></tr></table></figure>
<p>The optional <code>expiresAt</code> argument controls when the offer expires - i.e. using the token after that date will no longer grant permissions to that Realm. Users who have already consumed the token to obtain permissions will not lose their access after that date. If you want to revoke permissions, use <code>applyPermissionsAsync</code>.</p>
<p>Once a user has received a token, e.g. by sharing it via messaging app, or scanning a QR code, they can consume it to obtain the permissions offered:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const token = &quot;...&quot;;</span><br><span class="line">userB.acceptPermissionOffer(token)</span><br><span class="line">  .then(realmUrl =&gt; Realm.open(&#123; schema: [/* ... */], sync: &#123; user: userB, url: realmUrl &#125;&#125;))</span><br><span class="line">  .then(realm =&gt; &#123;</span><br><span class="line">    // ..use the realm</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Migrating-from-Realm-Object-Server-1-x-to-2-x"><a href="#Migrating-from-Realm-Object-Server-1-x-to-2-x" class="headerlink" title="Migrating from Realm Object Server 1.x to 2.x"></a>Migrating from Realm Object Server 1.x to 2.x</h3><p>If you upgrade Realm Object Server from version 1.x to 2.x, your Realms <strong>must</strong> be migrated. The new file format is incompatible, and Realms have to be re-downloaded.</p>
<p>When a synchronized Realm requiring migration is opened, the Realm file will be copied to a backup location and then deleted so that it can be re-downloaded from the Realm Object Server. An exception will be thrown, and you can choose to migrate your objects from the old Realm.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Realm.open(config)</span><br><span class="line">  .then(realm =&gt; &#123;</span><br><span class="line">    // you have probably already migrated</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(e =&gt; &#123;</span><br><span class="line">    if (e.name == &quot;IncompatibleSyncedRealmError&quot;) &#123;</span><br><span class="line">      const backupRealm = new Realm(e.configuration);</span><br><span class="line">      // copy objects from backupRealm</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Encryption"><a href="#Encryption" class="headerlink" title="Encryption"></a>Encryption<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><p>Please take note of the Export Compliance section of our LICENSE, as it places restrictions against the usage of Realm if you are located in countries with an export restriction or embargo from the United States.</p>
<p>Realm supports encrypting the database file on disk with AES-256+SHA2 by supplying a 64-byte encryption key when creating a Realm.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var key = new Int8Array(64);  // pupulate with a secure key</span><br><span class="line">Realm.open(&#123;schema: [CarObject], encryptionKey: key&#125;)</span><br><span class="line">  .then(realm =&gt; &#123;</span><br><span class="line">    // Use the Realm as normal</span><br><span class="line">    var dogs = realm.objects(&apos;Car&apos;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>This makes it so that all of the data stored on disk is transparently encrypted and decrypted with AES-256 as needed, and verified with a SHA-2 HMAC. The same encryption key must be supplied every time you obtain a Realm instance.</p>
<p>There is a small performance hit (typically less than 10% slower) when using encrypted Realms.</p>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><h3 id="Missing-Realm-Constructor"><a href="#Missing-Realm-Constructor" class="headerlink" title="Missing Realm Constructor"></a>Missing Realm Constructor</h3><p>If your app crashes, telling you that the Realm constructor was not found, there are a few things you can try:</p>
<p>First of all, run <code>react-native link realm</code></p>
<p>If that doesn’t help, and your problem is on Android, try:</p>
<p>Add the following in your <code>MainApplication.java</code> file: <code>java import io.realm.react.RealmReactPackage;</code></p>
<p>And add the <code>RealmReactPackage</code> to the list of packages:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">protected List getPackages() &#123;</span><br><span class="line">    return Arrays.asList(</span><br><span class="line">        new MainReactPackage(),</span><br><span class="line">        new RealmReactPackage() // add this line</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>add following two lines in <code>settings.gradle</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include &apos;:realm&apos;</span><br><span class="line">project(&apos;:realm&apos;).projectDir = new File(settingsDir, &apos;../node_modules/realm/android&apos;)</span><br></pre></td></tr></table></figure>
<p>If your problem is on iOS, try: 1. Close all simulators/device builds 2. Stop the package manager running in terminal (or better yet, just restart terminal) 3. Open the ios folder in your app root in finder 4. Go into the build folder (note: you won’t see this build folder in atom, so just right click ios and click open in finder) 5. Delete everything inside of the build folder (just move to trash and keep trash around in case you’re worried) 6. Run <code>react-native run-ios</code> to rebuild the whole thing</p>
<h3 id="Chrome-Debugging-is-slow"><a href="#Chrome-Debugging-is-slow" class="headerlink" title="Chrome Debugging is slow"></a>Chrome Debugging is slow</h3><p>We are aware of this. The reason for this is that since Realm is written in C++ and runs native code, it has to run on the device/simulator. But given the zero-copy architecture, we need to send values in realm objects over the RPC wire every time you inspect an object that is stored in a Realm.</p>
<p>We are investigating various potential solutions for this problem. If you want to keep track of it, you can follow the <a href="https://github.com/realm/realm-js/issues/491" target="_blank" rel="noopener">GitHub issue</a>.</p>
<h3 id="Crash-Reporting"><a href="#Crash-Reporting" class="headerlink" title="Crash Reporting"></a>Crash Reporting</h3><p>We encourage you to use a crash reporter in your application. Many Realm operations could potentially fail at runtime (like any other disk IO), so collecting crash reports from your application will help identify areas where either you (or us) can improve error handling and fix crashing bugs.</p>
<p>Most commercial crash reporters have the option of collecting logs. We strongly encourage you to enable this feature. Realm logs metadata information (but no user data) when throwing exceptions and in irrecoverable situations, and these messages can help debug when things go wrong.</p>
<h2 id="Getting-help"><a href="#Getting-help" class="headerlink" title="Getting help"></a>Getting help<img src="https://realm.io/assets/svg/docs/thumbs-up.svg" alt="img"><img src="https://realm.io/assets/svg/docs/thumbs-down.svg" alt="img"></h2><ul>
<li><strong>Need help with your code?</strong> <a href="http://stackoverflow.com/questions/ask?tags=realm" target="_blank" rel="noopener">Ask on StackOverflow</a>. We actively monitor &amp; answer questions on SO!</li>
<li><strong>Have a bug to report?</strong> <a href="https://github.com/realm/realm-js/issues/new" target="_blank" rel="noopener">Open an issue on our repo</a>. If possible, include the version of Realm, a full log, the Realm file, and a project that shows the issue.</li>
<li><strong>Have a feature request?</strong> <a href="https://github.com/realm/realm-js/issues/new" target="_blank" rel="noopener">Open an issue on our repo</a>. Tell us what the feature should do, and why you want the feature.</li>
<li><strong>Love to follow what comes up next?</strong> <a href="https://github.com/realm/realm-js/blob/master/CHANGELOG.md" target="_blank" rel="noopener">Look at our changelog</a>. The log shows the latest additions and changes we plan to release soon, and the history of how Realm has evolved.<a href="https://realm.io/cn/products/realm-platform" target="_blank" rel="noopener"> <img src="https://realm.io/assets/img/home/features/radar.jpg" alt="Two‑way data sync, real‑time collaboration, offline‑first applications, API bridge, data push"> </a></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>感谢您的支持，这将鼓励我坚持技术分享！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://cn.gravatar.com/userimage/119205447/f356a9687dd39e3fb68fa6ad110b31a7.png?size=200" alt="William-Dream WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="http://cn.gravatar.com/userimage/119205447/aecd8d2eaf8428ddaad1b31aaf41a333.jpg?size=200" alt="William-Dream Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/02/npm_lib/" rel="next" title="如何开发一个JavaScript库">
                <i class="fa fa-chevron-left"></i> 如何开发一个JavaScript库
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/04/02/ubuntu_mongo_db/" rel="prev" title="Ubuntu安装MongoDB">
                Ubuntu安装MongoDB <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yODE4MC80NzUz"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://www.gravatar.com/avatar/c8b98e5df395f0e0fd3b47948b37b881.jpg?s=215"
               alt="William-Dream" />
          <p class="site-author-name" itemprop="name">William-Dream</p>
           
              <p class="site-description motion-element" itemprop="description">为了梦-追梦,我的英文名由此而来</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">83</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/li-jun-bo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.lijunbo.com/" title="Net" target="_blank">Net</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#介绍"><span class="nav-number">1.</span> <span class="nav-text">介绍 </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#入门"><span class="nav-number">2.</span> <span class="nav-text">入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">2.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#例子"><span class="nav-number">2.2.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Realm-Studio"><span class="nav-number">2.3.</span> <span class="nav-text">Realm Studio</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获得帮助"><span class="nav-number">3.</span> <span class="nav-text">获得帮助</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模型"><span class="nav-number">4.</span> <span class="nav-text">模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#类"><span class="nav-number">4.1.</span> <span class="nav-text">类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Supported-types"><span class="nav-number">4.2.</span> <span class="nav-text">Supported types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#可选属性"><span class="nav-number">4.2.1.</span> <span class="nav-text">可选属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#列表属性"><span class="nav-number">4.2.2.</span> <span class="nav-text">列表属性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关系"><span class="nav-number">4.3.</span> <span class="nav-text">关系</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一对一的关系"><span class="nav-number">4.3.1.</span> <span class="nav-text">一对一的关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一对多的关系"><span class="nav-number">4.3.2.</span> <span class="nav-text">一对多的关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多对多关系"><span class="nav-number">4.3.3.</span> <span class="nav-text">多对多关系</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#默认属性值"><span class="nav-number">4.4.</span> <span class="nav-text">默认属性值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引属性"><span class="nav-number">4.5.</span> <span class="nav-text">索引属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主键"><span class="nav-number">4.6.</span> <span class="nav-text">主键</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#写"><span class="nav-number">5.</span> <span class="nav-text">写</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建对象"><span class="nav-number">5.1.</span> <span class="nav-text">创建对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#嵌套对象"><span class="nav-number">5.2.</span> <span class="nav-text">嵌套对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更新对象"><span class="nav-number">5.3.</span> <span class="nav-text">更新对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#键入的更新"><span class="nav-number">5.3.1.</span> <span class="nav-text">键入的更新</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用主键创建和更新对象"><span class="nav-number">5.3.2.</span> <span class="nav-text">使用主键创建和更新对象</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除对象"><span class="nav-number">5.4.</span> <span class="nav-text">删除对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询"><span class="nav-number">6.</span> <span class="nav-text">查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#过滤"><span class="nav-number">6.1.</span> <span class="nav-text">过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sorting"><span class="nav-number">6.2.</span> <span class="nav-text">Sorting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自动更新结果集"><span class="nav-number">6.3.</span> <span class="nav-text">自动更新结果集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#限制结果集"><span class="nav-number">6.4.</span> <span class="nav-text">限制结果集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Realms"><span class="nav-number">7.</span> <span class="nav-text">Realms</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#打开Realm实例"><span class="nav-number">7.1.</span> <span class="nav-text">打开Realm实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#默认Realm实例"><span class="nav-number">7.2.</span> <span class="nav-text">默认Realm实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他Realm实例"><span class="nav-number">7.3.</span> <span class="nav-text">其他Realm实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Schema版本"><span class="nav-number">7.4.</span> <span class="nav-text">Schema版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异步打开Realm"><span class="nav-number">7.5.</span> <span class="nav-text">异步打开Realm</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#迁移"><span class="nav-number">8.</span> <span class="nav-text">迁移</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#进行迁移"><span class="nav-number">8.1.</span> <span class="nav-text">进行迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线性迁移"><span class="nav-number">8.2.</span> <span class="nav-text">线性迁移</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Notifications"><span class="nav-number">9.</span> <span class="nav-text">Notifications</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Realm通知"><span class="nav-number">9.1.</span> <span class="nav-text">Realm通知</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Collection-通知"><span class="nav-number">9.2.</span> <span class="nav-text">Collection 通知</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#同步"><span class="nav-number">10.</span> <span class="nav-text">同步</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用户"><span class="nav-number">10.1.</span> <span class="nav-text">用户</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#认证"><span class="nav-number">10.1.1.</span> <span class="nav-text">认证</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#用户名-密码"><span class="nav-number">10.1.1.1.</span> <span class="nav-text">用户名/密码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Google"><span class="nav-number">10.1.1.2.</span> <span class="nav-text">Google</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Facebook"><span class="nav-number">10.1.1.3.</span> <span class="nav-text">Facebook</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Custom-Auth"><span class="nav-number">10.1.1.4.</span> <span class="nav-text">Custom Auth</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Logging-Out"><span class="nav-number">10.1.1.5.</span> <span class="nav-text">Logging Out</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Working-with-Users"><span class="nav-number">10.1.2.</span> <span class="nav-text">Working with Users</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Opening-a-Synchronized-Realm"><span class="nav-number">10.2.</span> <span class="nav-text">Opening a Synchronized Realm</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Partially-synchronized-Realms"><span class="nav-number">10.2.1.</span> <span class="nav-text">Partially synchronized Realms</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-with-a-Synchronized-Realm"><span class="nav-number">10.3.</span> <span class="nav-text">Working with a Synchronized Realm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sync-Sessions"><span class="nav-number">10.4.</span> <span class="nav-text">Sync Sessions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Progress-notifications"><span class="nav-number">10.4.1.</span> <span class="nav-text">Progress notifications</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Control"><span class="nav-number">10.5.</span> <span class="nav-text">Access Control</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Retrieving-Permissions"><span class="nav-number">10.5.1.</span> <span class="nav-text">Retrieving Permissions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Modifying-Permissions"><span class="nav-number">10.5.2.</span> <span class="nav-text">Modifying Permissions</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Granting-Permissions"><span class="nav-number">10.5.2.1.</span> <span class="nav-text">Granting Permissions</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Offer-Response"><span class="nav-number">10.5.2.2.</span> <span class="nav-text">Offer/Response</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Migrating-from-Realm-Object-Server-1-x-to-2-x"><span class="nav-number">10.6.</span> <span class="nav-text">Migrating from Realm Object Server 1.x to 2.x</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Encryption"><span class="nav-number">11.</span> <span class="nav-text">Encryption</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshooting"><span class="nav-number">12.</span> <span class="nav-text">Troubleshooting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Missing-Realm-Constructor"><span class="nav-number">12.1.</span> <span class="nav-text">Missing Realm Constructor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chrome-Debugging-is-slow"><span class="nav-number">12.2.</span> <span class="nav-text">Chrome Debugging is slow</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crash-Reporting"><span class="nav-number">12.3.</span> <span class="nav-text">Crash Reporting</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Getting-help"><span class="nav-number">13.</span> <span class="nav-text">Getting help</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">William-Dream</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("PWTRJaGA9VmnmuJISstgYQVk-gzGzoHsz", "OhMVXOeW5jbdIohUayYbpq1v");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
  


  

</body>
</html>
